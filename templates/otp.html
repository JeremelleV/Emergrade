{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OTP Verification | StyleSense</title>
    <!-- Boxicons CSS -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'otp.css' %}" />
  </head>
  <body>
    <div class="floating-elements">
        <div class="floating-element">
            <i class="fas fa-tshirt"></i>
        </div>
        <div class="floating-element">
            <i class="fas fa-brain"></i>
        </div>
        <div class="floating-element">
            <i class="fas fa-leaf"></i>
        </div>
        <div class="floating-element">
            <i class="fas fa-ruler-combined"></i>
        </div>
    </div>
    
    <div class="container">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-leaf"></i>
            </div>
            Style<span>Sense</span>
        </div>
        <h2>Enter OTP</h2>
        <h4>OTP has been sent to your email</h4>
        <form action="/otp/" method="post">
            {% csrf_token %}
            <div class="input-field">
            <input id="p1" name="p1" type="number" pattern="[0-9]*" inputmode="numeric" required/>
            <input id="p2" name="p2" type="number" pattern="[0-9]*" inputmode="numeric" disabled required/>
            <input id="p3" name="p3" type="number" pattern="[0-9]*" inputmode="numeric" disabled required/>
            <input id="p4" name="p4" type="number" pattern="[0-9]*" inputmode="numeric" disabled required/>
            <input id="p5" name="p5" type="number" pattern="[0-9]*" inputmode="numeric" disabled required/>
            <input id="p6" name="p6" type="number" pattern="[0-9]*" inputmode="numeric" disabled required/>
            </div>
            <button type="submit">Verify OTP</button>
        </form>
        <div class="resend-option">
            Didn't receive the code? <a href="/login">Resend OTP</a>
        </div>
    </div>

    <script>
        const inputs = document.querySelectorAll("input"),
        button = document.querySelector("button");

        // iterate over all inputs
        inputs.forEach((input, index1) => {
            input.addEventListener("keyup", (e) => {
                // This code gets the current input element and stores it in the currentInput variable
                // This code gets the next sibling element of the current input element and stores it in the nextInput variable
                // This code gets the previous sibling element of the current input element and stores it in the prevInput variable
                const currentInput = input,
                    nextInput = input.nextElementSibling,
                    prevInput = input.previousElementSibling;

                // if the value has more than one character then clear it
                if (currentInput.value.length > 1) {
                    currentInput.value = "";
                    return;
                }
                
                // if the next input is disabled and the current value is not empty
                //  enable the next input and focus on it
                if (nextInput && nextInput.hasAttribute("disabled") && currentInput.value !== "") {
                    nextInput.removeAttribute("disabled");
                    nextInput.focus();
                }

                // if the backspace key is pressed
                if (e.key === "Backspace") {
                    // iterate over all inputs again
                    inputs.forEach((input, index2) => {
                        // if the index1 of the current input is less than or equal to the index2 of the input in the outer loop
                        // and the previous element exists, set the disabled attribute on the input and focus on the previous element
                        if (index1 <= index2 && prevInput) {
                            input.setAttribute("disabled", true);
                            input.value = "";
                            prevInput.focus();
                        }
                    });
                }
                
                //if the last input is not empty and has not disable attribute then
                //add active class if not then remove the active class.
                if (!inputs[5].disabled && inputs[5].value !== "") {
                    button.classList.add("active");
                    return;
                }
                button.classList.remove("active");
            });
        });

        //focus the first input which index is 0 on window load
        window.addEventListener("load", () => inputs[0].focus());

        // Add some visual feedback when inputs are filled
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.value !== '') {
                    this.style.borderColor = 'var(--primary)';
                    this.style.background = 'rgba(0, 201, 167, 0.05)';
                } else {
                    this.style.borderColor = '#e9ecef';
                    this.style.background = '#f8f9fa';
                }
            });
        });

        // Prevent non-numeric input
        inputs.forEach(input => {
            input.addEventListener('keydown', function(e) {
                // Allow: backspace, delete, tab, escape, enter
                if ([46, 8, 9, 27, 13].includes(e.keyCode) || 
                    // Allow: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
                    (e.keyCode === 65 && e.ctrlKey === true) || 
                    (e.keyCode === 67 && e.ctrlKey === true) || 
                    (e.keyCode === 86 && e.ctrlKey === true) || 
                    (e.keyCode === 88 && e.ctrlKey === true) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });
        });
    </script>
  </body>
</html>